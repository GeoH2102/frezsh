# Modern Zsh Configuration
# Managed with chezmoi - https://chezmoi.io

# ----- Environment -----
export PATH="$HOME/.local/bin:$PATH"
export EDITOR="nano"
export VISUAL="$EDITOR"

# ----- Zinit Plugin Manager -----
ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"
if [[ -f "${ZINIT_HOME}/zinit.zsh" ]]; then
    source "${ZINIT_HOME}/zinit.zsh"

    # Essential plugins with turbo mode (deferred loading)
    zinit wait lucid for \
        atinit"zicompinit; zicdreplay" \
            zdharma-continuum/fast-syntax-highlighting \
        atload"_zsh_autosuggest_start" \
            zsh-users/zsh-autosuggestions \
        blockf atpull'zinit creinstall -q .' \
            zsh-users/zsh-completions

    # Additional useful plugins
    zinit wait lucid for \
        OMZP::git \
        OMZP::sudo \
        OMZP::extract
fi

# ----- History -----
HISTFILE=~/.zsh_history
HISTSIZE=50000
SAVEHIST=50000
setopt EXTENDED_HISTORY       # Write timestamp to history
setopt HIST_EXPIRE_DUPS_FIRST # Expire duplicates first
setopt HIST_IGNORE_DUPS       # Ignore duplicates
setopt HIST_IGNORE_SPACE      # Ignore commands starting with space
setopt HIST_VERIFY            # Show command before executing from history
setopt SHARE_HISTORY          # Share history between sessions

# ----- Options -----
setopt AUTO_CD                # cd by typing directory name
setopt AUTO_PUSHD             # Push directories onto stack
setopt PUSHD_IGNORE_DUPS      # Don't push duplicates
setopt INTERACTIVE_COMMENTS   # Allow comments in interactive shell

# ----- Key Bindings -----
bindkey -e                    # Emacs key bindings
bindkey '^[[A' history-search-backward
bindkey '^[[B' history-search-forward

# ----- Completion -----
zstyle ':completion:*' menu select
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'  # Case insensitive

# ----- Modern Tool Integrations -----

# Zoxide (smart cd, replaces cd)
if command -v zoxide &> /dev/null; then
    eval "$(zoxide init zsh --cmd cd)"
fi

# FZF (fuzzy finder)
if command -v fzf &> /dev/null; then
    source <(fzf --zsh 2>/dev/null) || true
fi

# ----- Aliases -----

# Modern replacements (only if installed)
if command -v eza &> /dev/null; then
    alias ls='eza'
    alias ll='eza -l --git'
    alias la='eza -la --git'
    alias lt='eza --tree --level=2'
else
    alias ll='ls -l'
    alias la='ls -la'
fi

if command -v bat &> /dev/null; then
    alias cat='bat --paging=never'
    alias catp='bat'  # With paging
fi

if command -v rg &> /dev/null; then
    alias grep='rg'
fi

# Common shortcuts
alias ..='cd ..'
alias ...='cd ../..'
alias g='git'
alias gst='git status'
alias gd='git diff'
alias gc='git commit'
alias gp='git push'
alias gl='git pull'

# ----- Starship Prompt -----
if command -v starship &> /dev/null; then
    eval "$(starship init zsh)"
fi

# ----- Atuin (load last to ensure Ctrl+R binding) -----
if command -v atuin &> /dev/null; then
    eval "$(atuin init zsh)"
fi
